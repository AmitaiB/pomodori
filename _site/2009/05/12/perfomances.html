<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width = 750">
    <link rel="stylesheet" type="text/css" href="../../../css/stylesheet.css" charset="utf-8">
    <title>Fixed performance issue</title>
  </head>
  <body id="intro">
    <div id="wrapper">
      <div id="header" onclick="javascript:window.location='/pomodori/'">
        <img src="../../../resources/pomologo-shade.png"/>
      </div>

      <div><h1><b>Pomodori Blog</b></h1></div>
      <div id="navigation">
        <ul>
          <li id="navi_intro">
            <a href="/pomodori/">Intro</a>
          </li>
          <li id="navi_source">
            <a href="http://github.com/reborg/pomodori">Source</a>
          </li>
          <li id="navi_tickets">
            <a href="http://github.com/reborg/pomodori/issues">Issues</a>
          </li>
        </ul>
      </div>
      <div id="page_body">
        <div id="content">
          <h1 id='well_over_400_pomodoros'>Well over 400 Pomodoros</h1>

<p>I started noticing an increasing delay during the use of the Pomodori tool since some weeks ago. I easily correlated the problem to the increasing number of pomodoros in my pomodoro database. Right now I have around 450 entries in the table and every time I started Pomodori, or simply switching between running/break status resulted in this annoying 2 secs refresh of the user interface.</p>

<p>I decided to investigate and I found to major problems: first, I was calling the computation of the average twice by mistake and second, even removing the double call, find all pomodoros was really slow. I had a look at the Kirbybase manual to see what I was doing wrong and there is a very nicely done <a href='http://www.netpromi.com/files/kirbybase_ruby_manual.html#tips-on-improving-performance' title='Perf section'>performance section there</a> that says &#8220;Beware of Date/DateTime&#8221;. Of course I was using Time as the database type for pomodoros timestamps!</p>

<p>I migrated the type of the column to string and modified the rest of the application to deal with string comparisons for date related queries. I created a <a href='http://github.com/reborg/pomodori/blob/master/lib/pomodori/extensions/timestamp.rb' title='String Extension'>string extension</a> to deal with timestamps. The problem then was how to migrate the already existing database file (pomodoro.tbl) to the new column type. I extracted the migration portion from KirbyStorage into a new <a href='http://github.com/reborg/pomodori/blob/master/lib/pomodori/migration.rb' title='Migration Class'>migration class</a> where I check at startup if the database should be migrated. So if you are using Pomodori already you shouldn&#8217;t be worried to trash your old pomodoro history.</p>

<p>Now I&#8217;m happy to have back my nice and fluid Pomodori interface. By the way numbers for the find all went down from 1.4s to 0.14s.</p>

<h2 id='new_features'>New Features</h2>

<p>There are several other important things I&#8217;m working on right now. I&#8217;m going to open a window if you click on the yesterday&#8217;s count to show you the related Pomodoros. The pomodoro/count/day that now is a separate chart will be integrated in the main window to give you a quick overview of your performance in the last 30 days. I&#8217;m also working on a secret feature&#8230;. don&#8217;t tell anyone.</p>

<p><em>Happy pomodoros to all</em></p>
                    
          <script type="text/javascript">var disqus_url = "http://reborg.github.com/pomodori/"; var disqus_title ="";</script>
          <div id="disqus_thread"></div><script type="text/javascript" src="http://disqus.com/forums/pomodori/embed.js"></script>
          <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
          <script type="text/javascript">
          //<![CDATA[
          (function() {
          		var links = document.getElementsByTagName('a');
          		var query = '?';
          		for(var i = 0; i < links.length; i++) {
          			if(links[i].href.indexOf('#disqus_thread') >= 0) {
          				query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          			}
          		}
          		document.write('<script type="text/javascript" src="http://disqus.com/forums/pomodori/get_num_replies.js' + query + '"></' + 'script>');
          	})();
          //]]>
          </script>
          
        </div>
        <div id="sidebar">
          <div class="item">
            <h5><a href="http://reborg.github.com/pomodori/resources/pomodori-0.7.zip">Latest Lion-only Pomodori 0.7</a></h5>
            <h5><a href="http://reborg.github.com/pomodori/resources/pomodori-0.6.zip">Snow Leopard Pomodori 0.6</a></h5>
            <h5><a href="http://github.com/reborg/pomodori/issues">Tickets at GitHub</a></h5>
            <h5><a href="http://github.com/reborg/pomodori/tree/master">The Project on GitHub</a></h5>
            <h5><a href="http://blog.reborg.net/">My Blog</a></h5>
            <h5><a href="http://www.vimeo.com/4546375">Video Introduction to the Pomodoro Technique</a></h5>
            <h5><a href="http://www.pomodorotechnique.com/">Pomodoro Technique Main Site</a></h5>
          </div>
          <div class="item">
            <h4>Other Posts</h4>
            <p>
               
                <span>18 Dec 2011</span> » <a href="/2011/12/18/macruby-0.7-lion.html">Latest Pomodori 0.7 now compatible with Lion</a><br>
               
                <span>06 Jul 2010</span> » <a href="/2010/07/06/macruby-0.6.html">Upgrade to MacRuby 0.6</a><br>
               
                <span>25 Feb 2010</span> » <a href="/2010/02/25/32-bits-limitation.html">32 bits architecture limitation</a><br>
               
                <span>09 Feb 2010</span> » <a href="/2010/02/09/ann-0.5-snow-leopard.html">Pomodori 0.5 now on Snow Leopard</a><br>
               
                <span>26 Oct 2009</span> » <a href="/2009/10/26/ann-0.4-and-snow.html">Pomodori 0.4 and Snow Leopard Issues</a><br>
               
                <span>08 Jun 2009</span> » <a href="/2009/06/08/historyview.html">View History Feature</a><br>
               
                <span>12 May 2009</span> » <a href="/2009/05/12/perfomances.html">Fixed performance issue</a><br>
               
                <span>16 Apr 2009</span> » <a href="/2009/04/16/todo.html">history table view</a><br>
               
                <span>15 Apr 2009</span> » <a href="/2009/04/15/todo.html">making space on the main view</a><br>
               
                <span>14 Apr 2009</span> » <a href="/2009/04/14/todo.html">average pomodoros and specs</a><br>
               
                <span>06 Apr 2009</span> » <a href="/2009/04/06/todo.html">chirb talk</a><br>
               
                <span>04 Apr 2009</span> » <a href="/2009/04/04/ann-0.2.html">Announcing 0.2 release</a><br>
               
                <span>03 Apr 2009</span> » <a href="/2009/04/03/todo.html">clean-up charts for 0.2</a><br>
               
                <span>31 Mar 2009</span> » <a href="/2009/03/31/todo.html">summary chart</a><br>
               
                <span>29 Mar 2009</span> » <a href="/2009/03/29/todo.html">template processing</a><br>
               
                <span>27 Mar 2009</span> » <a href="/2009/03/27/todo.html">charts in progress</a><br>
               
                <span>26 Mar 2009</span> » <a href="/2009/03/26/todo.html">back to charts</a><br>
               
                <span>24 Mar 2009</span> » <a href="/2009/03/24/todo.html">extracting controllers</a><br>
               
                <span>23 Mar 2009</span> » <a href="/2009/03/23/todo.html">closing huge refactoring (hopefully)</a><br>
               
                <span>20 Mar 2009</span> » <a href="/2009/03/20/todo.html">controllers refactoring</a><br>
               
                <span>19 Mar 2009</span> » <a href="/2009/03/19/todo.html">extracting controllers</a><br>
               
                <span>17 Mar 2009</span> » <a href="/2009/03/17/todo.html">main view work in progress</a><br>
               
                <span>16 Mar 2009</span> » <a href="/2009/03/16/todo.html">some refactoring</a><br>
               
                <span>13 Mar 2009</span> » <a href="/2009/03/13/charts.html">work on charts started</a><br>
              
            </p>
          </div>
          <div class="item">
            <script type="text/javascript" src="http://disqus.com/forums/pomodori/combination_widget.js?num_items=5&color=orange&default_tab=recent"></script>
          </div>
        </div>
      </div>
      <div id="footer">
        <p><a href="http://github.com/reborg/pomodori/tree/gh-pages" title="reborg's pomodori at gh-pages &mdash; GitHub">website source</a> | generated by <a href="http://github.com/mojombo/jekyll">jekyll</a> and <a href="http://drnic.github.com/jekyll_generator">jekyll_generator</a></p>
      </div>
    </div>
    <a href="http://github.com/reborg/pomodori"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>
  </body>
</html>
